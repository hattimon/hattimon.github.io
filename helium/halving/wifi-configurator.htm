<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SenseCap M1 - Generator Konfiguracji Sieci</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 650px; margin: 20px auto; padding: 0 15px; background: #f4f4f4; }
  h2 { text-align: center; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input[type=text], input[type=password], select { width: 100%; padding: 8px; margin-top: 5px; }
  textarea { width: 100%; height: 320px; margin-top: 15px; font-family: monospace; }
  button { margin-top: 15px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  #musicControl { background: #222; color: white; border: none; border-radius: 5px; }
</style>
</head>
<body>

<h2>SenseCap M1 - Generator Konfiguracji Sieci</h2>

<button id="musicControl">ðŸ”Š WÅ‚Ä…cz/WyÅ‚Ä…cz muzykÄ™</button>

<form id="configForm">
  <label for="mode">Tryb konfiguracji:</label>
  <select id="mode" required>
    <option value="wifi" selected>WiFi</option>
    <option value="ethernet">Tylko Ethernet (wyÅ‚Ä…cz WiFi)</option>
  </select>

  <div id="wifiFields">
    <label for="ssid">Nazwa WiFi (SSID):</label>
    <input type="text" id="ssid" />

    <label for="psk">HasÅ‚o do WiFi:</label>
    <input type="password" id="psk" />

    <label for="staticIp">Czy ustawiÄ‡ statyczne IP?</label>
    <select id="staticIp" required>
      <option value="nie" selected>DHCP (auto)</option>
      <option value="tak">Statyczne IP</option>
    </select>

    <div id="staticIpFields" style="display:none;">
      <label for="ip">Statyczny adres IP (np. 192.168.0.245/24):</label>
      <input type="text" id="ip" />

      <label for="gateway">Bramka sieciowa (np. 192.168.0.1):</label>
      <input type="text" id="gateway" />

      <label for="dns">DNS (np. 8.8.8.8):</label>
      <input type="text" id="dns" />
    </div>
  </div>

  <button type="submit">Generuj skrypt</button>
</form>

<label for="output">Wygenerowany skrypt bash (kopiuj i wklej w terminalu SenseCap):</label>
<textarea id="output" readonly></textarea>

<audio id="bgMusic" loop autoplay>
  <source src="keygen.mp3" type="audio/mpeg">
</audio>

<script>
  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  function generateScript(mode, ssid, psk, staticIp, ip, gateway, dns) {
    let script = "#!/bin/bash\n";
    if (mode === "ethernet") {
      script += "# UsuÅ„ wszystkie poÅ‚Ä…czenia WiFi i wyÅ‚Ä…cz radio WiFi\n";
      script += "rm -f /mnt/boot/system-connections/wifi.nmconnection\n";
      script += "rm -f /etc/NetworkManager/system-connections/*.nmconnection 2>/dev/null\n";
      script += "nmcli radio wifi off\n";
      script += "systemctl restart NetworkManager\n";
      return script;
    } else {
      script += `cat <<EOF > /mnt/boot/system-connections/wifi.nmconnection
[connection]
id=wifi
uuid=${generateUUID()}
type=wifi
autoconnect=true

[wifi]
ssid=${ssid}
mode=infrastructure

[wifi-security]
key-mgmt=wpa-psk
psk=${psk}

[ipv4]
method=${staticIp ? 'manual' : 'auto'}`;
      if (staticIp) {
        script += `
address1=${ip},${gateway}
dns=${dns || '8.8.8.8'}
dns-search=
`;
      } else {
        script += `\n`;
      }
      script += `[ipv6]
method=ignore
EOF

chmod 600 /mnt/boot/system-connections/wifi.nmconnection
systemctl restart NetworkManager
`;
    }
    return script;
  }

  document.getElementById('staticIp').addEventListener('change', function() {
    document.getElementById('staticIpFields').style.display = this.value === 'tak' ? 'block' : 'none';
  });

  document.getElementById('mode').addEventListener('change', function() {
    document.getElementById('wifiFields').style.display = this.value === 'wifi' ? 'block' : 'none';
  });

  document.getElementById('configForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const mode = document.getElementById('mode').value;
    const ssid = document.getElementById('ssid').value.trim();
    const psk = document.getElementById('psk').value.trim();
    const staticIp = document.getElementById('staticIp').value === 'tak';
    const ip = document.getElementById('ip').value.trim();
    const gateway = document.getElementById('gateway').value.trim();
    const dns = document.getElementById('dns').value.trim();

    if (mode === "wifi" && (!ssid || !psk)) {
      alert('Podaj SSID i hasÅ‚o do WiFi.');
      return;
    }
    if (mode === "wifi" && staticIp && (!ip || !gateway)) {
      alert('Podaj IP i bramÄ™ dla statycznego adresu.');
      return;
    }

    document.getElementById('output').value = generateScript(mode, ssid, psk, staticIp, ip, gateway, dns);
  });

  // ObsÅ‚uga muzyki w tle
  const bgMusic = document.getElementById('bgMusic');
  const musicControl = document.getElementById('musicControl');
  musicControl.addEventListener('click', () => {
    if (bgMusic.paused) {
      bgMusic.play();
    } else {
      bgMusic.pause();
    }
  });
</script>

</body>
</html>
