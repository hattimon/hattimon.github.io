<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BinarySwap</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>BinarySwap - Swap, Add Liquidity i więcej</h1>

    <div id="wallet-status">
        <p id="wallet-address">Portfel odłączony</p>
        <button id="connect-btn">Połącz z MetaMask</button>
        <button id="disconnect-btn" style="display:none;">Odłącz portfel</button>
    </div>

    <div id="balances">
        <h3>Twoje tokeny</h3>
        <div id="balances-list"></div>
    </div>

    <div id="pool-info-section">
        <h3>Informacje o puli</h3>
        <label for="pool-id">Pool ID:</label>
        <input type="number" id="pool-id" placeholder="Wpisz ID puli">
        <button id="get-pool-info-btn">Pobierz informacje o puli</button>
        <div id="pool-info"></div>
    </div>

    <div id="pending-cub-section">
        <h3>Pending Cub</h3>
        <button id="get-pending-cub-btn">Pobierz Pending Cub</button>
        <div id="pending-cub"></div>
    </div>

    <script>
        // Kontrakt MasterChef
        const MASTER_CHEF_ADDRESS = '0x39a786421889EB581bd105508a0D2Dc03523B903';
        const TOKEN_0101_ADDRESS = '0xa41B3067eC694DBec668c389550bA8fc589e5797'; // Adres tokena 0101

        let provider, signer;
        let isConnected = false;

        // Połączenie z MetaMask
        async function connectWallet() {
            if (window.ethereum) {
                await ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                const address = await signer.getAddress();
                document.getElementById("wallet-address").innerText = `Połączono: ${address}`;
                document.getElementById("connect-btn").style.display = "none";
                document.getElementById("disconnect-btn").style.display = "block";
                isConnected = true;
                loadTokenBalances();
            } else {
                alert("Zainstaluj MetaMask!");
            }
        }

        // Odłączenie portfela
        async function disconnectWallet() {
            signer = null;
            provider = null;
            isConnected = false;
            document.getElementById("wallet-address").innerText = "Portfel odłączony";
            document.getElementById("connect-btn").style.display = "block";
            document.getElementById("disconnect-btn").style.display = "none";
            document.getElementById("balances-list").innerHTML = "";
            document.getElementById("pending-cub").innerHTML = "";
            document.getElementById("pool-info").innerHTML = "";
        }

        // Ładowanie sald tokenów
        async function loadTokenBalances() {
            const balances = [];

            // BNB Balance
            try {
                const bnbBalance = await provider.getBalance(await signer.getAddress());
                balances.push({ symbol: 'BNB', amount: ethers.formatUnits(bnbBalance, 18) });
            } catch (error) {
                console.error("Błąd pobierania salda BNB:", error);
            }

            // Token 0101 Balance
            try {
                const token0101Contract = new ethers.Contract(TOKEN_0101_ADDRESS, ['function balanceOf(address) view returns (uint256)'], signer);
                const token0101Balance = await token0101Contract.balanceOf(await signer.getAddress());
                balances.push({ symbol: '0101', amount: ethers.formatUnits(token0101Balance, 18) });
            } catch (error) {
                console.error("Błąd pobierania salda 0101:", error);
            }

            updateTokenBalances(balances);
        }

        // Wyświetlanie sald tokenów
        function updateTokenBalances(balances) {
            const balanceList = document.getElementById('balances-list');
            balanceList.innerHTML = '';
            balances.forEach(balance => {
                const balanceElement = document.createElement('p');
                balanceElement.innerText = `${balance.symbol}: ${balance.amount}`;
                balanceList.appendChild(balanceElement);
            });
        }

        // Pobieranie informacji o puli
        async function getPoolInfo() {
            const poolId = document.getElementById("pool-id").value;
            if (!poolId) {
                alert("Proszę podać Pool ID!");
                return;
            }

            const masterChefContract = new ethers.Contract(MASTER_CHEF_ADDRESS, [
                'function poolInfo(uint256) view returns (address lpToken, uint256 allocPoint, uint256 lastRewardBlock, uint256 accCubPerShare, uint16 depositFeeBP)',
            ], provider);

            try {
                const poolData = await masterChefContract.poolInfo(poolId);
                document.getElementById("pool-info").innerHTML = `
                    LP Token: ${poolData[0]}<br>
                    Alokacja punktów: ${poolData[1]}<br>
                    Ostatni blok nagród: ${poolData[2]}<br>
                    Acc Cub per Share: ${poolData[3]}<br>
                    Opłata depozytowa (Basis Points): ${poolData[4]}
                `;
            } catch (error) {
                console.error("Błąd pobierania informacji o puli:", error);
                alert("Wystąpił błąd!");
            }
        }

        // Pobieranie Pending Cub
        async function getPendingCub() {
            const poolId = document.getElementById("pool-id").value;
            if (!poolId) {
                alert("Proszę podać Pool ID!");
                return;
            }

            const masterChefContract = new ethers.Contract(MASTER_CHEF_ADDRESS, [
                'function pendingCub(uint256, address) view returns (uint256)',
            ], provider);

            try {
                const pendingAmount = await masterChefContract.pendingCub(poolId, await signer.getAddress());
                document.getElementById("pending-cub").innerHTML = `Pending Cub: ${ethers.formatUnits(pendingAmount, 18)}`;
            } catch (error) {
                console.error("Błąd pobierania pendingCub:", error);
                alert("Wystąpił błąd!");
            }
        }

        // Event listeners
        document.getElementById("connect-btn").addEventListener("click", connectWallet);
        document.getElementById("disconnect-btn").addEventListener("click", disconnectWallet);
        document.getElementById("get-pool-info-btn").addEventListener("click", getPoolInfo);
        document.getElementById("get-pending-cub-btn").addEventListener("click", getPendingCub);

        window.onload = () => {
            document.getElementById("disconnect-btn").style.display = "none"; // Hide disconnect initially
        };
    </script>
</body>
</html>
