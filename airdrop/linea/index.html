<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linea Airdrop</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone@7.22.5/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@0.11.0/dist/js-confetti.browser.js"></script>
  <style>
    body {
      background-color: #000;
      background-image: url('space.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #fff;
      font-family: 'Arial', sans-serif;
    }
    .stargate {
      width: 400px;
      height: 400px;
      border-radius: 50%;
      position: relative;
      background: radial-gradient(circle at center, rgba(0, 0, 255, 0.1) 0%, rgba(0, 0, 0, 0.8) 70%);
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.7), 0 0 40px rgba(0, 191, 255, 0.4), inset 0 0 50px rgba(0, 191, 255, 0.3);
      animation: glowPulse 6s infinite alternate;
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 20px rgba(0, 191, 255, 0.7), 0 0 40px rgba(0, 191, 255, 0.4), inset 0 0 30px rgba(0, 191, 255, 0.3); }
      50% { box-shadow: 0 0 30px rgba(0, 191, 255, 0.9), 0 0 60px rgba(0, 191, 255, 0.6), inset 0 0 70px rgba(0, 191, 255, 0.5); }
      100% { box-shadow: 0 0 20px rgba(0, 191, 255, 0.7), 0 0 40px rgba(0, 191, 255, 0.4), inset 0 0 30px rgba(0, 191, 255, 0.3); }
    }
    .stargate::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle at center, rgba(0, 191, 255, 0.3) 0%, transparent 70%);
      opacity: 0.6;
      animation: ripple 3s infinite;
      z-index: 1;
    }
    @keyframes ripple {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.3; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
    }
    .stargate::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 250px;
      height: 250px;
      border-radius: 50%;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
      opacity: 0.4;
      animation: innerGlow 4s infinite alternate;
      z-index: 2;
    }
    @keyframes innerGlow {
      0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.2); }
      100% { box-shadow: 0 0 30px rgba(0, 191, 255, 0.5); }
    }
    .notification {
      background: linear-gradient(135deg, #1f2937, #111827);
      border: 1px solid #4b5563;
      border-radius: 8px;
      padding: 16px;
      max-width: 400px;
      margin: 8px auto;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      color: #d1d5db;
      animation: slideIn 0.5s ease-out;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    .notification.success {
      border-color: #10b981;
      background: linear-gradient(135deg, #065f46, #064e3b);
    }
    .notification.error {
      border-color: #ef4444;
      background: linear-gradient(135deg, #7f1d1d, #991b1b);
    }
    .notification-header {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #facc15;
    }
    .notification-message {
      font-size: 0.9rem;
      line-height: 1.5;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .claim-button {
      padding: 12px 24px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(90deg, #ff4500, #ff8c00, #ffd700);
      border: none;
      border-radius: 25px;
      cursor: pointer;
      text-shadow: 0 0 5px #fff;
      box-shadow: 0 0 10px #ff4500, 0 0 20px #ff8c00;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .claim-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #ff4500, 0 0 30px #ff8c00;
    }
    .claim-button:active {
      transform: scale(0.95);
    }
    .token-balance, .tokens-to-claim {
      margin: 10px 0;
      font-size: 1.2rem;
      color: linear-gradient(90deg, #ff4500, #ff8c00, #ffd700);
      -webkit-text-fill-color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: linear-gradient(90deg, #ff4500, #ff8c00, #ffd700);
      -webkit-text-fill-color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
    }
    p {
      font-size: 1.1rem;
      color: linear-gradient(90deg, #ff4500, #ff8c00, #ffd700);
      -webkit-text-fill-color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
    }
    .disclaimer {
      font-size: 0.8rem;
      color: #d1d5db;
      max-width: 600px;
      margin: 20px auto;
      padding: 10px;
      background: rgba(31, 41, 55, 0.8);
      border-radius: 8px;
    }
    .spin-section {
      margin-top: 20px;
      text-align: center;
    }
    .spin-table {
      width: 100%;
      max-width: 400px;
      margin: 10px auto;
      border-collapse: collapse;
    }
    .spin-table td {
      padding: 8px;
      border: 1px solid #4b5563;
    }
  </style>
</head>
<body class="font-mono">
  <div id="root"></div>
  <audio id="bgMusic" loop autoplay>
    <source src="https://ia600501.us.archive.org/22/items/tvtunes_1120/Stargate%20Atlantis.mp3" type="audio/mpeg">
  </audio>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const CONTRACT_ADDRESS = '0x87baa1694381ae3ecae2660d97fe60404080eb64';
    const LINEA_CHAIN_ID = '0xe708';
    const LINEA_RPC = 'https://rpc.linea.build';
    const LINEA_EXPLORER = 'https://lineascan.build';
    const TOKEN_ADDRESS = '0x1789e0043623282d5dcc7f213d703c6d8bafbb04';
    const ABI = [{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_ownerAddress","type":"address"},{"internalType":"uint256","name":"_claimEnd","type":"uint256"},{"internalType":"address","name":"_primaryFactorAddress","type":"address"},{"internalType":"address","name":"_primaryConditionalMultiplierAddress","type":"address"},{"internalType":"address","name":"_secondaryFactorAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"AllCalculationFactorsZero","type":"error"},{"inputs":[],"name":"AlreadyClaimed","type":"error"},{"inputs":[],"name":"ClaimAmountIsZero","type":"error"},{"inputs":[],"name":"ClaimEndTooShort","type":"error"},{"inputs":[],"name":"ClaimFinished","type":"error"},{"inputs":[],"name":"ClaimNotFinished","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[],"name":"RenouncingOwnershipDisabled","type":"error"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"SafeERC20FailedOperation","type":"error"},{"inputs":[],"name":"ZeroAddressNotAllowed","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"address","name":"primaryFactor","type":"address"},{"indexed":false,"internalType":"address","name":"primaryMultiplier","type":"address"},{"indexed":false,"internalType":"address","name":"secondaryFactor","type":"address"},{"indexed":false,"internalType":"uint256","name":"claimEndTimestamp","type":"uint256"}],"name":"AirdropConfigured","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Claimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferStarted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokenBalanceWithdrawn","type":"event"},{"inputs":[],"name":"CLAIM_END","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DENOMINATOR","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PRIMARY_CONDITIONAL_MULTIPLIER_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PRIMARY_FACTOR_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SECONDARY_FACTOR_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKEN","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_account","type":"address"}],"name":"calculateAllocation","outputs":[{"internalType":"uint256","name":"tokenAllocation","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"hasClaimed","outputs":[{"internalType":"bool","name":"claimed","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pendingOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}];

    function App() {
      const [web3, setWeb3] = useState(null);
      const [account, setAccount] = useState(null);
      const [contract, setContract] = useState(null);
      const [amount, setAmount] = useState('0');
      const [hasClaimed, setHasClaimed] = useState(false);
      const [error, setError] = useState('');
      const [musicPlaying, setMusicPlaying] = useState(true);
      const [currentChainId, setCurrentChainId] = useState(null);
      const [notifications, setNotifications] = useState([]);
      const [spins, setSpins] = useState(0);
      const jsConfetti = new JSConfetti();

      useEffect(() => {
        if (window.ethereum) {
          const web3Instance = new Web3(window.ethereum);
          setWeb3(web3Instance);
          window.ethereum.request({ method: 'eth_chainId' }).then(setCurrentChainId);
          window.ethereum.on('chainChanged', setCurrentChainId);
          window.ethereum.on('accountsChanged', (accounts) => {
            setAccount(accounts[0]);
            fetchData(web3Instance, accounts[0]);
          });
        } else {
          setError('MetaMask or Rabby is not installed.');
        }
      }, []);

      useEffect(() => {
        if (web3) {
          loadContract();
        }
      }, [web3]);

      useEffect(() => {
        if (account && contract) {
          fetchData();
        }
      }, [account, contract]);

      useEffect(() => {
        const audio = document.getElementById('bgMusic');
        if (musicPlaying) {
          audio.play().catch(() => {});
        } else {
          audio.pause();
        }
      }, [musicPlaying]);

      useEffect(() => {
        const timers = notifications.map(notification =>
          setTimeout(() => {
            setNotifications(prev => prev.filter(n => n.id !== notification.id));
          }, 7000)
        );
        return () => timers.forEach(clearTimeout);
      }, [notifications]);

      const loadContract = () => {
        try {
          const contractInstance = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
          setContract(contractInstance);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Failed to load contract: ' + err.message, type: 'error' }]);
        }
      };

      const connectWallet = async () => {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          setAccount(accounts[0]);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Wallet connection failed: ' + err.message, type: 'error' }]);
        }
      };

      const disconnectWallet = () => {
        setAccount(null);
        setAmount('0');
        setHasClaimed(false);
      };

      const switchToLinea = async () => {
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: LINEA_CHAIN_ID }],
          });
        } catch (switchError) {
          if (switchError.code === 4902) {
            try {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: LINEA_CHAIN_ID,
                  chainName: 'Linea',
                  nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                  rpcUrls: [LINEA_RPC],
                  blockExplorerUrls: [LINEA_EXPLORER],
                }],
              });
            } catch (addError) {
              setNotifications([...notifications, { id: Date.now(), message: 'Failed to add Linea network: ' + addError.message, type: 'error' }]);
            }
          } else {
            setNotifications([...notifications, { id: Date.now(), message: 'Failed to switch to Linea: ' + switchError.message, type: 'error' }]);
          }
        }
      };

      const fetchData = async () => {
        if (!contract || !account) return;
        try {
          const alloc = await contract.methods.calculateAllocation(account).call();
          const formattedAmount = web3.utils.fromWei(alloc, 'ether');
          setAmount(formattedAmount === '0' ? '0' : Number(formattedAmount).toLocaleString('en-US', { maximumFractionDigits: 2 }));
          const claimed = await contract.methods.hasClaimed(account).call();
          setHasClaimed(claimed);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Failed to fetch data: ' + err.message, type: 'error' }]);
        }
      };

      const handleClaim = async () => {
        if (!contract || !account) return;
        try {
          const tx = await contract.methods.claim().send({ from: account });
          setHasClaimed(true);
          jsConfetti.addConfetti({
            emojis: ['🎉', '✨', '💥', '🌟', '🎊'],
            confettiNumber: 200,
            confettiRadius: 6,
          });
          setNotifications([...notifications, { id: Date.now(), message: 'Transaction successful! Tokens claimed.', type: 'success' }]);
          fetchData();
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: `Transaction failed: ${err.message}`, type: 'error' }]);
        }
      };

      if (currentChainId !== LINEA_CHAIN_ID) {
        return (
          <div className="flex flex-col items-center justify-center h-screen">
            <h1>Airdrop</h1>
            <button
              className="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-500"
              onClick={switchToLinea}
            >
              Switch to Linea Network
            </button>
            {notifications.map(notification => (
              <div key={notification.id} className={`notification ${notification.type}`}>
                <div className="notification-header">{notification.type === 'success' ? 'Transaction Successful!' : 'Transaction Failed!'}</div>
                <div className="notification-message">{notification.message}</div>
              </div>
            ))}
          </div>
        );
      }

      return (
        <div className="relative min-h-screen">
          <div className="absolute top-4 right-4 flex space-x-4">
            {!account ? (
              <button
                className="bg-green-600 text-white px-4 py-2 rounded flex items-center"
                onClick={connectWallet}
              >
                <i className="fas fa-wallet mr-2"></i> Connect Wallet
              </button>
            ) : (
              <button
                className="bg-red-600 text-white px-4 py-2 rounded flex items-center"
                onClick={disconnectWallet}
              >
                <i className="fas fa-sign-out-alt mr-2"></i> Disconnect
              </button>
            )}
            <button
              className="bg-gray-600 text-white px-4 py-2 rounded flex items-center"
              onClick={() => setMusicPlaying(!musicPlaying)}
            >
              <i className={`fas ${musicPlaying ? 'fa-volume-up' : 'fa-volume-mute'} mr-2`}></i>
              {musicPlaying ? 'Mute' : 'Play'} Music
            </button>
          </div>
          <div className="flex flex-col items-center justify-center h-screen">
            <h1>Check Your Airdrop Eligibility</h1>
            <p className="text-center mb-4">Need help?</p>
            <div className="disclaimer">
              This interface is provided by the Linea Association ("Provider") solely to allow users to check whether a submitted crypto wallet address may be eligible to claim tokens related to the Linea TGE. This service is informational only and does not constitute financial, investment, or legal advice. Results shown by the interface are preliminary and provided "as is." Eligibility indicated by the service does not guarantee allocation, receipt, or transfer of any tokens. Final eligibility and distribution may be different. Users are responsible for ensuring that they submit the correct wallet address. The service does not request or require private keys—never share private keys. Users remain solely responsible for securing their wallet and funds. The Provider assumes no responsibility for losses, errors, or damages of any kind arising from use of this interface, including reliance on eligibility information. Users must ensure that accessing this service and claiming any tokens complies with the laws and regulations of their jurisdiction, including any restrictions on digital assets. The Provider reserves the right to modify, suspend, or discontinue the service at any time without notice. By using this interface, you acknowledge and agree to these Terms & Conditions. If you do not agree, you must not use the service.
            </div>
            {account ? (
              <>
                <div className="tokens-to-claim mt-4">Tokens to Claim: {amount}</div>
                {hasClaimed ? (
                  <p className="text-xl text-yellow-400 mt-4">Already Claimed</p>
                ) : parseFloat(amount) > 0 ? (
                  <div className="stargate mt-4">
                    <button
                      className="claim-button mt-4"
                      onClick={handleClaim}
                    >
                      CLAIM
                    </button>
                  </div>
                ) : (
                  <p className="text-xl text-red-400 mt-4">Not Eligible</p>
                )}
                <div className="spin-section">
                  <p>wheel icon</p>
                  <p>{spins} Spins</p>
                  <table className="spin-table">
                    <tbody>
                      <tr>
                        <td>Review spin history</td>
                        <td>Begin playing to discover the actions that granted you extra spins.</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </>
            ) : (
              <p className="text-xl mt-4">Connect your wallet to check eligibility</p>
            )}
            {notifications.map(notification => (
              <div key={notification.id} className={`notification ${notification.type}`}>
                <div className="notification-header">{notification.type === 'success' ? 'Transaction Successful!' : 'Transaction Failed!'}</div>
                <div className="notification-message">{notification.message}</div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
