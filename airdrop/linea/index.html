<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linea Airdrop</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone@7.22.5/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@0.11.0/dist/js-confetti.browser.js"></script>
  <style>
    body {
      background: url('stargate.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #00ffcc;
      margin: 0;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .hacker-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://www.toptal.com/designers/subtlepatterns/patterns/matrix.png');
      opacity: 0.1;
      animation: glitch 2s infinite;
    }
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-5px, 5px); }
      40% { transform: translate(5px, -5px); }
      60% { transform: translate(-5px, -5px); }
      80% { transform: translate(5px, 5px); }
      100% { transform: translate(0); }
    }
    .container {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 6rem;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
      animation: pulse 2s infinite;
      margin-bottom: 20px;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    p {
      font-size: 1.5rem;
      color: #00ffcc;
      text-shadow: 0 0 5px #00ffcc;
      margin-bottom: 20px;
    }
    a {
      color: #ff00ff;
      text-decoration: underline;
      animation: neon 1.5s infinite;
    }
    @keyframes neon {
      0% { text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff; }
      50% { text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; }
      100% { text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff; }
    }
    .stargate {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, #00ffcc 0%, rgba(10, 10, 35, 0.8) 100%);
      border: 5px solid #00ffcc;
      border-radius: 50%;
      position: relative;
      box-shadow: 0 0 20px #00ffcc, inset 0 0 20px #00ffcc;
      animation: rotate 10s linear infinite;
    }
    @media (max-width: 768px) {
      .stargate {
        width: 200px;
        height: 200px;
      }
    }
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .connect-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 15px 30px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #0a0a23;
      background: linear-gradient(45deg, #00ffcc, #ff00ff);
      border: none;
      border-radius: 25px;
      cursor: pointer;
      text-shadow: 0 0 5px #fff;
      box-shadow: 0 0 15px #00ffcc;
      transition: all 0.3s ease;
    }
    .connect-btn:hover {
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 0 25px #ff00ff;
    }
    .connect-btn:active {
      transform: translate(-50%, -50%) scale(0.95);
    }
    .notification {
      background: #1a1a3d;
      border: 1px solid #00ffcc;
      border-radius: 5px;
      padding: 10px;
      margin: 10px 0;
      box-shadow: 0 0 10px #00ffcc;
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .notification-header {
      font-size: 1.2rem;
      color: #ff00ff;
    }
    .notification-message {
      font-size: 1rem;
    }
    .close-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      color: #ff00ff;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      h1 {
        font-size: 3rem;
      }
      p {
        font-size: 1rem;
      }
      .connect-btn {
        font-size: 1rem;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="hacker-bg"></div>
  <div id="root"></div>
  <audio id="bgMusic" loop autoplay>
    <source src="https://ia600501.us.archive.org/22/items/tvtunes_1120/Stargate%20Atlantis.mp3" type="audio/mpeg">
  </audio>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const CONTRACT_ADDRESS = '0x87baa1694381ae3ecae2660d97fe60404080eb64';
    const LINEA_CHAIN_ID = '0xe708';
    const LINEA_RPC = 'https://rpc.linea.build';
    const LINEA_EXPLORER = 'https://lineascan.build';
    const TOKEN_ADDRESS = '0x1789e0043623282d5dcc7f213d703c6d8bafbb04';
    const ABI = [{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_ownerAddress","type":"address"},{"internalType":"uint256","name":"_claimEnd","type":"uint256"},{"internalType":"address","name":"_primaryFactorAddress","type":"address"},{"internalType":"address","name":"_primaryConditionalMultiplierAddress","type":"address"},{"internalType":"address","name":"_secondaryFactorAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"AllCalculationFactorsZero","type":"error"},{"inputs":[],"name":"AlreadyClaimed","type":"error"},{"inputs":[],"name":"ClaimAmountIsZero","type":"error"},{"inputs":[],"name":"ClaimEndTooShort","type":"error"},{"inputs":[],"name":"ClaimFinished","type":"error"},{"inputs":[],"name":"ClaimNotFinished","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[],"name":"RenouncingOwnershipDisabled","type":"error"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"SafeERC20FailedOperation","type":"error"},{"inputs":[],"name":"ZeroAddressNotAllowed","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"address","name":"primaryFactor","type":"address"},{"indexed":false,"internalType":"address","name":"primaryMultiplier","type":"address"},{"indexed":false,"internalType":"address","name":"secondaryFactor","type":"address"},{"indexed":false,"internalType":"uint256","name":"claimEndTimestamp","type":"uint256"}],"name":"AirdropConfigured","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Claimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferStarted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokenBalanceWithdrawn","type":"event"},{"inputs":[],"name":"CLAIM_END","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DENOMINATOR","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PRIMARY_CONDITIONAL_MULTIPLIER_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PRIMARY_FACTOR_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SECONDARY_FACTOR_ADDRESS","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKEN","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_account","type":"address"}],"name":"calculateAllocation","outputs":[{"internalType":"uint256","name":"tokenAllocation","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"hasClaimed","outputs":[{"internalType":"bool","name":"claimed","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pendingOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}];

    function App() {
      const [web3, setWeb3] = useState(null);
      const [account, setAccount] = useState(null);
      const [contract, setContract] = useState(null);
      const [amount, setAmount] = useState('0');
      const [hasClaimed, setHasClaimed] = useState(false);
      const [error, setError] = useState('');
      const [musicPlaying, setMusicPlaying] = useState(true);
      const [currentChainId, setCurrentChainId] = useState(null);
      const [notifications, setNotifications] = useState([]);
      const jsConfetti = new JSConfetti();

      useEffect(() => {
        if (window.ethereum) {
          const web3Instance = new Web3(window.ethereum);
          setWeb3(web3Instance);
          window.ethereum.request({ method: 'eth_chainId' }).then(setCurrentChainId);
          window.ethereum.on('chainChanged', setCurrentChainId);
          window.ethereum.on('accountsChanged', (accounts) => {
            setAccount(accounts[0]);
            fetchData(web3Instance, accounts[0]);
          });
        } else {
          setError('MetaMask or Rabby is not installed.');
        }
      }, []);

      useEffect(() => {
        if (web3) {
          loadContract();
        }
      }, [web3]);

      useEffect(() => {
        if (account && contract) {
          fetchData();
        }
      }, [account, contract]);

      useEffect(() => {
        const audio = document.getElementById('bgMusic');
        if (musicPlaying) {
          audio.play().catch(() => {});
        } else {
          audio.pause();
        }
      }, [musicPlaying]);

      useEffect(() => {
        const timers = notifications.map(notification =>
          setTimeout(() => {
            setNotifications(prev => prev.filter(n => n.id !== notification.id));
          }, 7000)
        );
        return () => timers.forEach(clearTimeout);
      }, [notifications]);

      const loadContract = () => {
        try {
          const contractInstance = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
          setContract(contractInstance);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Failed to load contract: ' + err.message, type: 'error' }]);
        }
      };

      const connectWallet = async () => {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          setAccount(accounts[0]);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Wallet connection failed: ' + err.message, type: 'error' }]);
        }
      };

      const disconnectWallet = () => {
        setAccount(null);
        setAmount('0');
        setHasClaimed(false);
      };

      const switchToLinea = async () => {
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: LINEA_CHAIN_ID }],
          });
        } catch (switchError) {
          if (switchError.code === 4902) {
            try {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: LINEA_CHAIN_ID,
                  chainName: 'Linea',
                  nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                  rpcUrls: [LINEA_RPC],
                  blockExplorerUrls: [LINEA_EXPLORER],
                }],
              });
            } catch (addError) {
              setNotifications([...notifications, { id: Date.now(), message: 'Failed to add Linea network: ' + addError.message, type: 'error' }]);
            }
          } else {
            setNotifications([...notifications, { id: Date.now(), message: 'Failed to switch to Linea: ' + switchError.message, type: 'error' }]);
          }
        }
      };

      const fetchData = async () => {
        if (!contract || !account) return;
        try {
          const alloc = await contract.methods.calculateAllocation(account).call();
          setAmount(web3.utils.fromWei(alloc, 'ether'));
          const claimed = await contract.methods.hasClaimed(account).call();
          setHasClaimed(claimed);
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: 'Failed to fetch data: ' + err.message, type: 'error' }]);
        }
      };

      const handleClaim = async () => {
        if (!contract || !account) return;
        try {
          const tx = await contract.methods.claim().send({ from: account });
          setHasClaimed(true);
          jsConfetti.addConfetti({
            emojis: ['🎉', '✨', '💥', '🌟', '🎊'],
            confettiNumber: 200,
            confettiRadius: 6,
          });
          setNotifications([...notifications, { id: Date.now(), message: 'Transaction successful! Tokens claimed.', type: 'success' }]);
          fetchData();
        } catch (err) {
          setNotifications([...notifications, { id: Date.now(), message: `Transaction failed: ${err.message}`, type: 'error' }]);
        }
      };

      if (currentChainId !== LINEA_CHAIN_ID) {
        return (
          <div className="container">
            <h1>Linea Airdrop</h1>
            <button
              className="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-500"
              onClick={switchToLinea}
            >
              Switch to Linea Network
            </button>
            {notifications.map(notification => (
              <div key={notification.id} className="notification">
                <div className="notification-header">{notification.type === 'success' ? 'Transaction Successful!' : 'Transaction Failed!'}</div>
                <div className="notification-message">{notification.message}</div>
                <button className="close-btn" onClick={() => setNotifications(notifications.filter(n => n.id !== notification.id))}>X</button>
              </div>
            ))}
          </div>
        );
      }

      return (
        <div className="container">
          <div className="absolute top-4 right-4 flex space-x-4">
            {!account ? (
              <button
                className="connect-btn"
                onClick={connectWallet}
              >
                Connect Wallet
              </button>
            ) : (
              <button
                className="bg-red-600 text-white px-4 py-2 rounded flex items-center"
                onClick={disconnectWallet}
              >
                <i className="fas fa-sign-out-alt mr-2"></i> Disconnect
              </button>
            )}
            <button
              className="bg-gray-600 text-white px-4 py-2 rounded flex items-center"
              onClick={() => setMusicPlaying(!musicPlaying)}
            >
              <i className={`fas ${musicPlaying ? 'fa-volume-up' : 'fa-volume-mute'} mr-2`}></i>
              {musicPlaying ? 'Mute' : 'Play'} Music
            </button>
          </div>
          <h1>Linea Airdrop</h1>
          <p>
            Token Contract: 
            <a 
              href="https://lineascan.build/token/0x1789e0043623282d5dcc7f213d703c6d8bafbb04#balances" 
              target="_blank" 
              rel="noopener noreferrer"
            >
              0x1789e0043623282d5dcc7f213d703c6d8bafbb04
            </a>
          </p>
          {account ? (
            <>
              <p>Tokens to Claim: {amount}</p>
              {hasClaimed ? (
                <p className="text-yellow-400">Already Claimed</p>
              ) : parseFloat(amount) > 0 ? (
                <div className="stargate">
                  <button
                    className="connect-btn"
                    onClick={handleClaim}
                  >
                    CLAIM
                  </button>
                </div>
              ) : (
                <p className="text-red-400">Not Eligible</p>
              )}
            </>
          ) : (
            <p>Connect your wallet to check eligibility</p>
          )}
          {notifications.map(notification => (
            <div key={notification.id} className="notification">
              <div className="notification-header">{notification.type === 'success' ? 'Transaction Successful!' : 'Transaction Failed!'}</div>
              <div className="notification-message">{notification.message}</div>
              <button className="close-btn" onClick={() => setNotifications(notifications.filter(n => n.id !== notification.id))}>X</button>
            </div>
          ))}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
